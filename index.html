<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Authentication API Test</title>
  </head>
  <body>
    <h1>Web Authentication API (Biometric Authentication)</h1>
    <button id="registerButton">Register Biometric</button>
    <button id="authButton">Authenticate</button>

    <script>
      document
        .getElementById("registerButton")
        .addEventListener("click", () => {
          if ("credentials" in navigator) {
            const options = {
              publicKey: {
                challenge: new Uint8Array(32), // Secure random challenge
                rp: {
                  name: "Your App Name",
                },
                user: {
                  id: new Uint8Array(16), // Unique user ID
                  name: "user@example.com", // User's name or email
                  displayName: "User Name",
                },
                pubKeyCredParams: [
                  {
                    type: "public-key",
                    alg: -7, // ES256 algorithm
                  },
                ],
                timeout: 60000, // 60 seconds timeout
                attestation: "direct", // Attestation options
              },
            };

            navigator.credentials
              .create(options)
              .then((credential) => {
                console.log("Registration successful:", credential);
                alert("Registration successful!");
              })
              .catch((error) => {
                console.error("Registration failed:", error);
              });
          } else {
            console.error("Web Authentication API not supported.");
          }
        });

      document.getElementById("authButton").addEventListener("click", () => {
        if ("credentials" in navigator) {
          const options = {
            publicKey: {
              challenge: new Uint8Array(32), // Use a secure random value for the challenge
              allowCredentials: [
                {
                  id: new Uint8Array(32), // The ID of the credential
                  type: "public-key",
                },
              ],
              userVerification: "preferred",
            },
          };

          navigator.credentials
            .get(options)
            .then((credential) => {
              if (credential) {
                alert("Authentication successful");
                console.log("Credential ID:", credential.id);
                console.log("Raw Id:", new Uint8Array(credential.rawId));
                console.log("Response:", credential.response);
              }
            })
            .catch((error) => {
              console.error("Authentication failed:", error);
            });
        } else {
          console.error("Web Authentication API not supported.");
        }
      });
    </script>
  </body>
</html>
